<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cwl.qzzp.dao.PositioninfoDao">
    <resultMap id="BaseResultMap" type="com.cwl.qzzp.dto.PositioninfoDTO">
        <id column="pId" jdbcType="CHAR" property="pid"/>
        <result column="dataId" jdbcType="CHAR" property="dataid"/>
        <result column="reId" jdbcType="CHAR" property="reid"/>
        <result column="pTitle" jdbcType="VARCHAR" property="ptitle"/>
        <result column="salary" jdbcType="VARCHAR" property="salary"/>
        <result column="experience" jdbcType="VARCHAR" property="experience"/>
        <result column="place" jdbcType="VARCHAR" property="place"/>
        <result column="temptation" jdbcType="VARCHAR" property="temptation"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="departments" jdbcType="VARCHAR" property="departments"/>
        <result column="states" jdbcType="VARCHAR" property="states"/>
        <result column="postNature" jdbcType="VARCHAR" property="postnature"/>
        <result column="postType1" jdbcType="VARCHAR" property="posttype1"/>
        <result column="postType2" jdbcType="VARCHAR" property="posttype2"/>
        <result column="postType3" jdbcType="VARCHAR" property="posttype3"/>
        <result column="postType4" jdbcType="VARCHAR" property="posttype4"/>
        <result column="postType5" jdbcType="VARCHAR" property="posttype5"/>
        <result column="releaseTime" jdbcType="TIMESTAMP" property="releasetime"/>
        <result column="visitNum" jdbcType="INTEGER" property="visitnum"/>
        <result column="education" jdbcType="VARCHAR" property="education"/>
    </resultMap>

    <resultMap id="BaseResultMap2" type="com.cwl.qzzp.dto.PositioninfoDTO">
        <id column="pId" jdbcType="CHAR" property="pid"/>
        <result column="dataId" jdbcType="CHAR" property="dataid"/>
        <result column="reId" jdbcType="CHAR" property="reid"/>
        <result column="pTitle" jdbcType="VARCHAR" property="ptitle"/>
        <result column="salary" jdbcType="VARCHAR" property="salary"/>
        <result column="experience" jdbcType="VARCHAR" property="experience"/>
        <result column="place" jdbcType="VARCHAR" property="place"/>
        <result column="temptation" jdbcType="VARCHAR" property="temptation"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="departments" jdbcType="VARCHAR" property="departments"/>
        <result column="states" jdbcType="VARCHAR" property="states"/>
        <result column="postNature" jdbcType="VARCHAR" property="postnature"/>
        <result column="postType1" jdbcType="VARCHAR" property="posttype1"/>
        <result column="postType2" jdbcType="VARCHAR" property="posttype2"/>
        <result column="postType3" jdbcType="VARCHAR" property="posttype3"/>
        <result column="postType4" jdbcType="VARCHAR" property="posttype4"/>
        <result column="postType5" jdbcType="VARCHAR" property="posttype5"/>
        <result column="releaseTime" jdbcType="TIMESTAMP" property="releasetime"/>
        <result column="visitNum" jdbcType="INTEGER" property="visitnum"/>
        <result column="education" jdbcType="VARCHAR" property="education"/>
        <association property="enterpriseinfoDTO" javaType="com.cwl.qzzp.dto.EnterpriseinfoDTO">
            <id column="eId" jdbcType="CHAR" property="eid"/>
            <result column="eName" jdbcType="VARCHAR" property="ename"/>
            <result column="ePlace" jdbcType="VARCHAR" property="eplace"/>
            <result column="signLanguage" jdbcType="VARCHAR" property="signlanguage"/>
            <result column="eIntroducation" jdbcType="VARCHAR" property="eintroducation"/>
            <result column="financingStage" jdbcType="VARCHAR" property="financingstage"/>
            <result column="category" jdbcType="VARCHAR" property="category"/>
            <result column="eUrl" jdbcType="VARCHAR" property="eurl"/>
            <result column="benefit1" jdbcType="VARCHAR" property="benefit1"/>
            <result column="benefit2" jdbcType="VARCHAR" property="benefit2"/>
            <result column="benefit3" jdbcType="VARCHAR" property="benefit3"/>
            <result column="benefit4" jdbcType="VARCHAR" property="benefit4"/>
            <result column="benefit5" jdbcType="VARCHAR" property="benefit5"/>
            <result column="numberOfWorkers" jdbcType="INTEGER" property="numberofworkers"/>
        </association>
        <collection property="appraiseDTO" ofType="com.cwl.qzzp.dto.AppraiseDTO"
                    resultMap="com.cwl.qzzp.dao.AppraiseDao.BaseResultMap"
                    column="dataId">
        </collection>
    </resultMap>

    <resultMap id="BaseResultMap3" type="com.cwl.qzzp.dto.PositioninfoDTO">
        <id column="pId" jdbcType="CHAR" property="pid"/>
        <result column="dataId" jdbcType="CHAR" property="dataid"/>
        <result column="reId" jdbcType="CHAR" property="reid"/>
        <result column="pTitle" jdbcType="VARCHAR" property="ptitle"/>
        <result column="salary" jdbcType="VARCHAR" property="salary"/>
        <result column="experience" jdbcType="VARCHAR" property="experience"/>
        <result column="place" jdbcType="VARCHAR" property="place"/>
        <result column="temptation" jdbcType="VARCHAR" property="temptation"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="departments" jdbcType="VARCHAR" property="departments"/>
        <result column="states" jdbcType="VARCHAR" property="states"/>
        <result column="postNature" jdbcType="VARCHAR" property="postnature"/>
        <result column="postType1" jdbcType="VARCHAR" property="posttype1"/>
        <result column="postType2" jdbcType="VARCHAR" property="posttype2"/>
        <result column="postType3" jdbcType="VARCHAR" property="posttype3"/>
        <result column="postType4" jdbcType="VARCHAR" property="posttype4"/>
        <result column="postType5" jdbcType="VARCHAR" property="posttype5"/>
        <result column="releaseTime" jdbcType="TIMESTAMP" property="releasetime"/>
        <result column="visitNum" jdbcType="INTEGER" property="visitnum"/>
        <result column="education" jdbcType="VARCHAR" property="education"/>
        <association property="enterpriseinfoDTO" javaType="com.cwl.qzzp.dto.EnterpriseinfoDTO">
            <id column="eId" jdbcType="CHAR" property="eid"/>
            <result column="logoImage" jdbcType="VARCHAR" property="logoimage"/>
            <result column="eName" jdbcType="VARCHAR" property="ename"/>
            <result column="ePlace" jdbcType="VARCHAR" property="eplace"/>
            <result column="signLanguage" jdbcType="VARCHAR" property="signlanguage"/>
            <result column="eIntroducation" jdbcType="VARCHAR" property="eintroducation"/>
            <result column="financingStage" jdbcType="VARCHAR" property="financingstage"/>
            <result column="category" jdbcType="VARCHAR" property="category"/>
            <result column="eUrl" jdbcType="VARCHAR" property="eurl"/>
            <result column="eImage1" jdbcType="VARCHAR" property="eimage1"/>
            <result column="eImage2" jdbcType="VARCHAR" property="eimage2"/>
            <result column="eImage3" jdbcType="VARCHAR" property="eimage3"/>
            <result column="evaluationNum" jdbcType="INTEGER" property="evaluationnum"/>
            <result column="positionNum" jdbcType="INTEGER" property="positionnum"/>
            <result column="dealRate" jdbcType="DOUBLE" property="dealrate"/>
            <result column="benefit1" jdbcType="VARCHAR" property="benefit1"/>
            <result column="benefit2" jdbcType="VARCHAR" property="benefit2"/>
            <result column="benefit3" jdbcType="VARCHAR" property="benefit3"/>
            <result column="benefit4" jdbcType="VARCHAR" property="benefit4"/>
            <result column="benefit5" jdbcType="VARCHAR" property="benefit5"/>
            <result column="visitNum" jdbcType="INTEGER" property="visitnum"/>
            <result column="numberOfWorkers" jdbcType="INTEGER" property="numberofworkers"/>
        </association>
    </resultMap>
    <sql id="Base_Column_List">
    pId, dataId, reId, pTitle, salary, experience, place, temptation, description, departments, 
    states, postNature, postType1, postType2, postType3, postType4, postType5, releaseTime, 
    visitNum,education
  </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from positioninfo
        where pId = #{pid,jdbcType=CHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from positioninfo
    where pId = #{pid,jdbcType=CHAR}
  </delete>
    <insert id="insert" keyColumn="pId" keyProperty="pid" parameterType="com.cwl.qzzp.dto.PositioninfoDTO"
            useGeneratedKeys="true">
    insert into positioninfo (dataId, reId, pTitle, 
      salary, experience, place, 
      temptation, description, departments, 
      states, postNature, postType1, 
      postType2, postType3, postType4, 
      postType5, releaseTime, visitNum,education
      )
    values (#{dataid,jdbcType=CHAR}, #{reid,jdbcType=CHAR}, #{ptitle,jdbcType=VARCHAR}, 
      #{salary,jdbcType=VARCHAR}, #{experience,jdbcType=VARCHAR}, #{place,jdbcType=VARCHAR}, 
      #{temptation,jdbcType=VARCHAR}, #{description,jdbcType=VARCHAR}, #{departments,jdbcType=VARCHAR}, 
      #{states,jdbcType=VARCHAR}, #{postnature,jdbcType=VARCHAR}, #{posttype1,jdbcType=VARCHAR}, 
      #{posttype2,jdbcType=VARCHAR}, #{posttype3,jdbcType=VARCHAR}, #{posttype4,jdbcType=VARCHAR}, 
      #{posttype5,jdbcType=VARCHAR}, #{releasetime,jdbcType=TIMESTAMP}, #{visitnum,jdbcType=INTEGER},#{education,jdbcType=VARCHAR}
      )
  </insert>

    <insert id="insertSelective" keyColumn="pId" keyProperty="pid" parameterType="com.cwl.qzzp.dto.PositioninfoDTO"
            useGeneratedKeys="true">
        insert into positioninfo
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="pid != null">
                pid,
            </if>
            <if test="dataid != null">
                dataId,
            </if>
            <if test="reid != null">
                reId,
            </if>
            <if test="ptitle != null">
                pTitle,
            </if>
            <if test="salary != null">
                salary,
            </if>
            <if test="experience != null">
                experience,
            </if>
            <if test="place != null">
                place,
            </if>
            <if test="temptation != null">
                temptation,
            </if>
            <if test="description != null">
                description,
            </if>
            <if test="departments != null">
                departments,
            </if>
            <if test="states != null">
                states,
            </if>
            <if test="postnature != null">
                postNature,
            </if>
            <if test="posttype1 != null">
                postType1,
            </if>
            <if test="posttype2 != null">
                postType2,
            </if>
            <if test="posttype3 != null">
                postType3,
            </if>
            <if test="posttype4 != null">
                postType4,
            </if>
            <if test="posttype5 != null">
                postType5,
            </if>
            releaseTime,
            <if test="visitnum != null">
                visitnum,
            </if>
            <if test="education !=null">
                education
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="pid != null">
                #{pid,jdbcType=CHAR},
            </if>
            <if test="dataid != null">
                #{dataid,jdbcType=CHAR},
            </if>
            <if test="reid != null">
                #{reid,jdbcType=CHAR},
            </if>
            <if test="ptitle != null">
                #{ptitle,jdbcType=VARCHAR},
            </if>
            <if test="salary != null">
                #{salary,jdbcType=VARCHAR},
            </if>
            <if test="experience != null">
                #{experience,jdbcType=VARCHAR},
            </if>
            <if test="place != null">
                #{place,jdbcType=VARCHAR},
            </if>
            <if test="temptation != null">
                #{temptation,jdbcType=VARCHAR},
            </if>
            <if test="description != null">
                #{description,jdbcType=VARCHAR},
            </if>
            <if test="departments != null">
                #{departments,jdbcType=VARCHAR},
            </if>
            <if test="states != null">
                #{states,jdbcType=VARCHAR},
            </if>
            <if test="postnature != null">
                #{postnature,jdbcType=VARCHAR},
            </if>
            <if test="posttype1 != null">
                #{posttype1,jdbcType=VARCHAR},
            </if>
            <if test="posttype2 != null">
                #{posttype2,jdbcType=VARCHAR},
            </if>
            <if test="posttype3 != null">
                #{posttype3,jdbcType=VARCHAR},
            </if>
            <if test="posttype4 != null">
                #{posttype4,jdbcType=VARCHAR},
            </if>
            <if test="posttype5 != null">
                #{posttype5,jdbcType=VARCHAR},
            </if>
            now(),
            <if test="visitnum != null">
                #{visitnum,jdbcType=INTEGER},
            </if>
            <if test="education !=null">
                #{education,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.cwl.qzzp.dto.PositioninfoDTO">
        update positioninfo
        <set>
            <if test="ptitle != null">
                pTitle = #{ptitle,jdbcType=VARCHAR},
            </if>
            <if test="salary != null">
                salary = #{salary,jdbcType=VARCHAR},
            </if>
            <if test="experience != null">
                experience = #{experience,jdbcType=VARCHAR},
            </if>
            <if test="place != null">
                place = #{place,jdbcType=VARCHAR},
            </if>
            <if test="temptation != null">
                temptation = #{temptation,jdbcType=VARCHAR},
            </if>
            <if test="departments != null">
                departments = #{departments,jdbcType=VARCHAR},
            </if>
            <if test="states != null">
                states = #{states,jdbcType=VARCHAR},
            </if>
            <if test="postnature != null">
                postNature = #{postnature,jdbcType=VARCHAR},
            </if>
            <if test="posttype1 != null">
                postType1 = #{posttype1,jdbcType=VARCHAR},
            </if>
            <if test="posttype2 != null">
                postType2 = #{posttype2,jdbcType=VARCHAR},
            </if>
            <if test="posttype3 != null">
                postType3 = #{posttype3,jdbcType=VARCHAR},
            </if>
            <if test="posttype4 != null">
                postType4 = #{posttype4,jdbcType=VARCHAR},
            </if>
            <if test="posttype5 != null">
                postType5 = #{posttype5,jdbcType=VARCHAR},
            </if>
            <if test="education !=null">
                education = #{education,jdbcType=VARCHAR},
            </if>
        </set>
        where pId = #{pid,jdbcType=CHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.cwl.qzzp.dto.PositioninfoDTO">
    update positioninfo
    set dataId = #{dataid,jdbcType=CHAR},
      reId = #{reid,jdbcType=CHAR},
      pTitle = #{ptitle,jdbcType=VARCHAR},
      salary = #{salary,jdbcType=VARCHAR},
      experience = #{experience,jdbcType=VARCHAR},
      place = #{place,jdbcType=VARCHAR},
      temptation = #{temptation,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      departments = #{departments,jdbcType=VARCHAR},
      states = #{states,jdbcType=VARCHAR},
      postNature = #{postnature,jdbcType=VARCHAR},
      postType1 = #{posttype1,jdbcType=VARCHAR},
      postType2 = #{posttype2,jdbcType=VARCHAR},
      postType3 = #{posttype3,jdbcType=VARCHAR},
      postType4 = #{posttype4,jdbcType=VARCHAR},
      postType5 = #{posttype5,jdbcType=VARCHAR},
      releaseTime = #{releasetime,jdbcType=TIMESTAMP},
      visitNum = #{visitnum,jdbcType=INTEGER}
    where pId = #{pid,jdbcType=CHAR}
  </update>

    <update id="updateVisitNum" parameterType="string">
        update positioninfo set visitNum=IFNULL(visitNum, 0)+1
        <where>
            <if test="pid != null and pid != ''">
                pId=#{pid}
            </if>
        </where>
    </update>

    <select id="getAllPosition" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from positioninfo
        where reId = #{reid,jdbcType=CHAR}
    </select>


    <select id="getIndexPosition" resultMap="BaseResultMap3">
        select
            p.pId,
            p.pTitle,
            p.departments,
            p.postnature,
            p.education,
            p.experience,
            p.releaseTime,
            p.salary,
            p.visitNum,
            e.category,
            e.eName,
            e.logoimage,
            e.financingstage,
            e.eplace
        from positioninfo p
         left join enterpriseinfo e on p.dataId = e.eId
        where states = '发布'
        order by p.visitNum desc
        limit 9;
    </select>

    <select id="getPositionInfoData" parameterType="string" resultMap="BaseResultMap2">
        select p.*,e.*,a.*
        from positioninfo p
        left join enterpriseinfo e on p.dataId = e.eId
        left join appraise a on p.pId = a.dataId
        where
        pId = #{pid}
    </select>

    <select id="getPositionData" resultMap="BaseResultMap3">
       select
            p.pId,
            p.pTitle,
            p.postnature,
            p.education,
            p.experience,
            p.releaseTime,
            p.salary,
            p.posttype1,
            p.posttype2,
            p.posttype3,
            p.posttype4,
            p.posttype5,
            e.category,
            e.eName,
            e.logoimage,
            e.benefit1,
            e.benefit2,
            e.benefit3,
            e.benefit4,
            e.benefit5,
            e.numberofworkers,
            e.financingstage
        from positioninfo p
        left join enterpriseinfo e on p.dataId = e.eId
    </select>

    <select id="getPositionInfoDTO" resultMap="BaseResultMap">
        select
        p.pId,
        p.pTitle,
        p.postnature,
        p.education,
        p.experience,
        p.releaseTime,
        p.salary,
        p.posttype1,
        p.posttype2,
        p.posttype3,
        p.posttype4,
        p.posttype5
        from positioninfo p where
        <if test="city !=null">
            p.place like concat('%',#{city},'%')
        </if>
        <if test="position !=null">
            and UPPER(p.pTitle) like concat('%',#{position},'%')
        </if>

    </select>


    <select id="deliveryRecord" resultMap="BaseResultMap">
         select
            p.pId,
            p.pTitle,
            p.postnature,
            p.education,
            p.experience,
            p.releaseTime,
            p.salary,
            p.posttype1,
            p.posttype2,
            p.posttype3,
            p.posttype4,
            p.posttype5
            from positioninfo p
            where p.pId in (select d.pid from delivery d where d.uid  =#{userid})
    </select>


    <select id="getPostion" resultMap="BaseResultMap">
        select  p.pId,
            p.pTitle
        from positioninfo p
        where p.reId = #{id,jdbcType=CHAR}
    </select>

</mapper>